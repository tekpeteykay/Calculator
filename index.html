<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Work Pay Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root {
        --primary: #2563eb;
        --secondary: #f3f4f6;
        --accent: #fbbf24;
        --danger: #ef4444;
        --radius: 8px;
    }
    body {
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        background: var(--secondary);
        color: #111;
    }
    header {
        background: var(--primary);
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 1.4em;
        font-weight: bold;
    }
    .container {
        max-width: 1000px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .rates {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        padding: 10px;
        border-radius: var(--radius);
        margin-bottom: 20px;
        font-size: 0.9em;
    }
    .flex {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }
    label {
        font-weight: 500;
        margin-bottom: 4px;
        display: block;
    }
    input, button, select {
        padding: 10px;
        font-size: 1em;
        border: 1px solid #d1d5db;
        border-radius: var(--radius);
        flex: 1;
        min-width: 120px;
    }
    button {
        background: var(--primary);
        color: white;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }
    button:hover {
        background: #1d4ed8;
    }
    .danger {
        background: var(--danger);
    }
    .danger:hover {
        background: #b91c1c;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        padding: 10px;
        border-bottom: 1px solid #e5e7eb;
        text-align: center;
    }
    th {
        background: #f3f4f6;
        font-weight: 600;
    }
    .totals {
        margin-top: 20px;
        background: #f9fafb;
        padding: 15px;
        border: 1px solid #e5e7eb;
        border-radius: var(--radius);
    }
    @media (max-width: 700px) {
        .flex { flex-direction: column; }
    }
</style>
</head>
<body>

<header>Work Pay Calculator</header>

<div class="container">

<div class="rates">
    <p>üí∑ <b>Base Rate:</b> ¬£13.85/hour &nbsp; | &nbsp; üå¥ <b>Holiday Pay:</b> ¬£1.67/hour &nbsp; | &nbsp; ‚è≥ <b>Total Rate:</b> ¬£15.52/hour</p>
    <p>üçΩ <b>Breaks:</b> 30 min if ‚â• 8 hours, 1 hour if ‚â• 10 hours (automatically deducted)</p>
</div>

<div class="flex">
    <div style="flex:1">
        <label for="startDate">Start Date</label>
        <input type="date" id="startDate">
    </div>
    <div style="flex:1">
        <label for="endDate">End Date</label>
        <input type="date" id="endDate">
    </div>
</div>

<hr>

<div class="flex">
    <div style="flex:1">
        <label for="date">Work Date</label>
        <input type="date" id="date">
    </div>
    <div style="flex:1">
        <label for="clockIn">Clock In</label>
        <input type="time" id="clockIn">
    </div>
    <div style="flex:1">
        <label for="clockOut">Clock Out</label>
        <input type="time" id="clockOut">
    </div>
    <div style="flex:1; align-self:flex-end;">
        <button onclick="addEntry()">Add Day</button>
    </div>
</div>

<table id="entriesTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Hours</th>
            <th>Break Taken</th>
            <th>Base Pay (¬£)</th>
            <th>Holiday Pay (¬£)</th>
            <th>Total (¬£)</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="totals">
    <p>Total Hours: <span id="totalHours">0</span></p>
    <p>Total Base Pay: ¬£<span id="totalBase">0.00</span></p>
    <p>Total Holiday Pay: ¬£<span id="totalHoliday">0.00</span></p>
    <p><b>Grand Total: ¬£<span id="grandTotal">0.00</span></b></p>
</div>

<div style="margin-top:15px;">
    <button onclick="archiveMonth()">üìÑ Archive & Save as PDF</button>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const BASE_RATE = 13.85;
const HOLIDAY_RATE = 1.67;
let entries = JSON.parse(localStorage.getItem('workEntries')) || [];

function saveEntries() {
    localStorage.setItem('workEntries', JSON.stringify(entries));
}

function calculateHours(inTime, outTime) {
    let inParts = inTime.split(":").map(Number);
    let outParts = outTime.split(":").map(Number);
    let inMinutes = inParts[0] * 60 + inParts[1];
    let outMinutes = outParts[0] * 60 + outParts[1];
    if (outMinutes <= inMinutes) outMinutes += 24 * 60; // after midnight
    let totalHours = (outMinutes - inMinutes) / 60;
    let breakTime = 0;

    if (totalHours >= 10) { totalHours -= 1; breakTime = 1; }
    else if (totalHours >= 8) { totalHours -= 0.5; breakTime = 0.5; }

    return { totalHours, breakTime };
}

function addEntry() {
    let startDate = document.getElementById('startDate').value;
    let endDate = document.getElementById('endDate').value;
    let date = document.getElementById('date').value;
    let clockIn = document.getElementById('clockIn').value;
    let clockOut = document.getElementById('clockOut').value;

    if (!startDate || !endDate) {
        alert("Please set the calculation timeframe first.");
        return;
    }
    if (!date || !clockIn || !clockOut) {
        alert("Please fill in all fields.");
        return;
    }
    if (new Date(date) < new Date(startDate) || new Date(date) > new Date(endDate)) {
        alert("Date must be within the selected timeframe.");
        return;
    }
    if (entries.some(e => e.date === date)) {
        alert("Entry for this date already exists.");
        return;
    }

    let { totalHours, breakTime } = calculateHours(clockIn, clockOut);
    let basePay = totalHours * BASE_RATE;
    let holidayPay = totalHours * HOLIDAY_RATE;
    let total = basePay + holidayPay;

    entries.push({ date, totalHours, breakTime, basePay, holidayPay, total });
    entries.sort((a, b) => new Date(a.date) - new Date(b.date));
    saveEntries();
    renderEntries();

    // Clear inputs
    document.getElementById('date').value = "";
    document.getElementById('clockIn').value = "";
    document.getElementById('clockOut').value = "";
}

function deleteEntry(index) {
    entries.splice(index, 1);
    saveEntries();
    renderEntries();
}

function renderEntries() {
    let tbody = document.querySelector("#entriesTable tbody");
    tbody.innerHTML = "";
    let totalHours = 0, totalBase = 0, totalHoliday = 0;

    entries.forEach((e, i) => {
        totalHours += e.totalHours;
        totalBase += e.basePay;
        totalHoliday += e.holidayPay;

        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${e.date}</td>
            <td>${e.totalHours.toFixed(2)}</td>
            <td>${(e.breakTime*60)} mins</td>
            <td>${e.basePay.toFixed(2)}</td>
            <td>${e.holidayPay.toFixed(2)}</td>
            <td>${e.total.toFixed(2)}</td>
            <td><button class="danger" onclick="deleteEntry(${i})">Delete</button></td>
        `;
        tbody.appendChild(tr);
    });

    document.getElementById('totalHours').innerText = totalHours.toFixed(2);
    document.getElementById('totalBase').innerText = totalBase.toFixed(2);
    document.getElementById('totalHoliday').innerText = totalHoliday.toFixed(2);
    document.getElementById('grandTotal').innerText = (totalBase + totalHoliday).toFixed(2);
}

function archiveMonth() {
    if (entries.length === 0) {
        alert("No entries to archive.");
        return;
    }

    let { jsPDF } = window.jspdf;
    let doc = new jsPDF();
    doc.setFontSize(14);
    doc.text("Work Pay Archive", 14, 20);

    let y = 30;
    doc.setFontSize(10);
    doc.text("Date | Hours | Break | Base Pay | Holiday Pay | Total", 14, y);
    y += 10;

    entries.forEach(e => {
        doc.text(`${e.date} | ${e.totalHours.toFixed(2)} | ${(e.breakTime*60)} mins | ¬£${e.basePay.toFixed(2)} | ¬£${e.holidayPay.toFixed(2)} | ¬£${e.total.toFixed(2)}`, 14, y);
        y += 8;
    });

    y += 5;
    doc.text(`Total Hours: ${document.getElementById('totalHours').innerText}`, 14, y); y += 6;
    doc.text(`Total Base Pay: ¬£${document.getElementById('totalBase').innerText}`, 14, y); y += 6;
    doc.text(`Total Holiday Pay: ¬£${document.getElementById('totalHoliday').innerText}`, 14, y); y += 6;
    doc.text(`Grand Total: ¬£${document.getElementById('grandTotal').innerText}`, 14, y);

    doc.save("work_archive.pdf");

    entries = [];
    saveEntries();
    renderEntries();
}

renderEntries();
</script>
</body>
</html>
