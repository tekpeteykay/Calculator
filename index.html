<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hourly Pay Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
<div id="root" class="p-4"></div>

<script type="text/babel">

function App() {
  const BASE_RATE = 13.85;
  const HOLIDAY_RATE = 1.67;
  const TOTAL_RATE = BASE_RATE + HOLIDAY_RATE;

  const [tab, setTab] = React.useState("current");
  const [employeeName, setEmployeeName] = React.useState(localStorage.getItem("employeeName") || "");
  const [fromDate, setFromDate] = React.useState(localStorage.getItem("fromDate") || "");
  const [toDate, setToDate] = React.useState(localStorage.getItem("toDate") || "");
  const [entries, setEntries] = React.useState(JSON.parse(localStorage.getItem("entries") || "[]"));
  const [archive, setArchive] = React.useState(JSON.parse(localStorage.getItem("archive") || "[]"));

  React.useEffect(() => {
    localStorage.setItem("employeeName", employeeName);
  }, [employeeName]);

  React.useEffect(() => {
    localStorage.setItem("fromDate", fromDate);
    localStorage.setItem("toDate", toDate);
  }, [fromDate, toDate]);

  React.useEffect(() => {
    localStorage.setItem("entries", JSON.stringify(entries));
  }, [entries]);

  React.useEffect(() => {
    localStorage.setItem("archive", JSON.stringify(archive));
  }, [archive]);

  const withinPayPeriod = (date) => {
    if (!fromDate || !toDate) return true;
    const d = new Date(date);
    return d >= new Date(fromDate) && d <= new Date(toDate);
  };

  const addEntry = (date, clockIn, clockOut) => {
    if (!withinPayPeriod(date)) {
      alert("Date must be within the selected pay period");
      return;
    }
    if (entries.find(e => e.date === date)) {
      alert("Entry for this date already exists.");
      return;
    }
    const ci = new Date(`1970-01-01T${clockIn}`);
    const co = new Date(`1970-01-01T${clockOut}`);
    let hours = (co - ci) / 36e5;
    let breakMinutes = 0;
    if (hours >= 10) breakMinutes = 60;
    else if (hours >= 8) breakMinutes = 30;
    hours -= breakMinutes / 60;
    setEntries([...entries, { date, clockIn, clockOut, hours, breakMinutes }].sort((a, b) => new Date(a.date) - new Date(b.date)));
  };

  const deleteEntry = (date) => {
    setEntries(entries.filter(e => e.date !== date));
  };

  const totalHours = entries.reduce((sum, e) => sum + e.hours, 0);
  const totalBase = totalHours * BASE_RATE;
  const totalHoliday = totalHours * HOLIDAY_RATE;
  const totalPay = totalBase + totalHoliday;

  const archiveMonth = () => {
    if (!fromDate || !toDate) {
      alert("Set a pay period first.");
      return;
    }
    const period = `${fromDate} to ${toDate}`;
    setArchive([...archive, { employeeName, period, entries }]);
    setEntries([]);
  };

  const exportPDF = () => {
    window.print();
  };

  const clearAll = () => {
    setEmployeeName("");
    setFromDate("");
    setToDate("");
    setEntries([]);
  };

  return (
    <div className="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-4">
      <div className="flex space-x-4 mb-4">
        <button className={`px-4 py-2 rounded ${tab === "current" ? "bg-blue-500 text-white" : "bg-gray-200"}`} onClick={() => setTab("current")}>Current Month</button>
        <button className={`px-4 py-2 rounded ${tab === "archive" ? "bg-blue-500 text-white" : "bg-gray-200"}`} onClick={() => setTab("archive")}>Archive Viewer</button>
      </div>

      {tab === "current" && (
        <>
          <h2 className="text-xl font-bold mb-2">Current Month — Pay Period: {fromDate && toDate ? `${fromDate} to ${toDate}` : "Not Set"}</h2>
          <div className="mb-4">
            <label className="block font-semibold">Employee Name</label>
            <input type="text" value={employeeName} onChange={(e) => setEmployeeName(e.target.value)} className="border p-2 w-full rounded"/>
          </div>

          <div className="flex space-x-4 mb-4">
            <div>
              <label className="block font-semibold">From Date</label>
              <input type="date" value={fromDate} onChange={(e) => setFromDate(e.target.value)} className="border p-2 rounded"/>
            </div>
            <div>
              <label className="block font-semibold">To Date</label>
              <input type="date" value={toDate} onChange={(e) => setToDate(e.target.value)} className="border p-2 rounded"/>
            </div>
          </div>

          <p className="mb-4 font-semibold">Rates: Base £{BASE_RATE.toFixed(2)} | Holiday £{HOLIDAY_RATE.toFixed(2)} | Total £{TOTAL_RATE.toFixed(2)}</p>

          <div className="flex space-x-4 mb-4">
            <div>
              <label className="block font-semibold">Date</label>
              <input id="date" type="date" className="border p-2 rounded"/>
            </div>
            <div>
              <label className="block font-semibold">Clock In</label>
              <input id="clockIn" type="time" className="border p-2 rounded"/>
            </div>
            <div>
              <label className="block font-semibold">Clock Out</label>
              <input id="clockOut" type="time" className="border p-2 rounded"/>
            </div>
            <button className="bg-green-500 text-white px-4 py-2 rounded self-end" onClick={() => {
              const date = document.getElementById("date").value;
              const ci = document.getElementById("clockIn").value;
              const co = document.getElementById("clockOut").value;
              addEntry(date, ci, co);
              document.getElementById("date").value = "";
              document.getElementById("clockIn").value = "";
              document.getElementById("clockOut").value = "";
            }}>Add Entry</button>
          </div>

          <table className="w-full border">
            <thead>
              <tr className="bg-gray-200">
                <th className="border p-2">Date</th>
                <th className="border p-2">Clock In</th>
                <th className="border p-2">Clock Out</th>
                <th className="border p-2">Break</th>
                <th className="border p-2">Hours</th>
                <th className="border p-2">Base Pay</th>
                <th className="border p-2">Holiday Pay</th>
                <th className="border p-2">Total</th>
                <th className="border p-2">Actions</th>
              </tr>
            </thead>
            <tbody>
              {entries.map(e => (
                <tr key={e.date}>
                  <td className="border p-2">{e.date}</td>
                  <td className="border p-2">{e.clockIn}</td>
                  <td className="border p-2">{e.clockOut}</td>
                  <td className="border p-2">{e.breakMinutes > 0 ? `${e.breakMinutes} min` : "No break"}</td>
                  <td className="border p-2">{e.hours.toFixed(2)}</td>
                  <td className="border p-2">£{(e.hours * BASE_RATE).toFixed(2)}</td>
                  <td className="border p-2">£{(e.hours * HOLIDAY_RATE).toFixed(2)}</td>
                  <td className="border p-2">£{(e.hours * TOTAL_RATE).toFixed(2)}</td>
                  <td className="border p-2">
                    <button className="bg-red-500 text-white px-2 py-1 rounded" onClick={() => deleteEntry(e.date)}>Delete</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>

          <div className="mt-4 font-bold">
            Total Hours: {totalHours.toFixed(2)} | Base: £{totalBase.toFixed(2)} | Holiday: £{totalHoliday.toFixed(2)} | Grand Total: £{totalPay.toFixed(2)}
          </div>

          <div className="flex space-x-4 mt-4">
            <button className="bg-blue-500 text-white px-4 py-2 rounded" onClick={exportPDF}>Export as PDF</button>
            <button className="bg-yellow-500 text-white px-4 py-2 rounded" onClick={archiveMonth}>Archive Month</button>
            <button className="bg-gray-500 text-white px-4 py-2 rounded" onClick={clearAll}>Clear All</button>
          </div>
        </>
      )}

      {tab === "archive" && (
        <>
          <h2 className="text-xl font-bold mb-4">Archived Months</h2>
          {archive.length === 0 && <p>No archived months.</p>}
          {archive.map((a, idx) => (
            <div key={idx} className="border rounded p-4 mb-4">
              <p><strong>Employee:</strong> {a.employeeName}</p>
              <p><strong>Period:</strong> {a.period}</p>
              <table className="w-full border mt-2">
                <thead>
                  <tr className="bg-gray-200">
                    <th className="border p-2">Date</th>
                    <th className="border p-2">Clock In</th>
                    <th className="border p-2">Clock Out</th>
                    <th className="border p-2">Break</th>
                    <th className="border p-2">Hours</th>
                    <th className="border p-2">Base Pay</th>
                    <th className="border p-2">Holiday Pay</th>
                    <th className="border p-2">Total</th>
                  </tr>
                </thead>
                <tbody>
                  {a.entries.map(e => (
                    <tr key={e.date}>
                      <td className="border p-2">{e.date}</td>
                      <td className="border p-2">{e.clockIn}</td>
                      <td className="border p-2">{e.clockOut}</td>
                      <td className="border p-2">{e.breakMinutes > 0 ? `${e.breakMinutes} min` : "No break"}</td>
                      <td className="border p-2">{e.hours.toFixed(2)}</td>
                      <td className="border p-2">£{(e.hours * BASE_RATE).toFixed(2)}</td>
                      <td className="border p-2">£{(e.hours * HOLIDAY_RATE).toFixed(2)}</td>
                      <td className="border p-2">£{(e.hours * TOTAL_RATE).toFixed(2)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          ))}
        </>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
